<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=Edge"><meta http-equiv=permissions-policy content="interest-cohort=()"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#2b7bb5"><meta name=copyright content="Copyright (c)2025 Erik McClure"><meta name=keywords content="games,music,code,erik mcclure,erikmcclure,aurora theory,sweetie bot,discord,feathergui,fading light,tinyoal,cloud hop"><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=google-site-verification content="Oxb2ia8HjcHLXlvstA8xPpQO3BO_y15Ds2Ia-feq1MQ"><meta name=generator content="Hugo 0.119.0"><link rel=me href=https://equestria.social/@cloudhop><link rel=canonical href=https://erikmcclure.com/blog/><link rel=apple-touch-icon href=https://erikmcclure.com/favicon.ico><link rel="shortcut icon" type=image/x-icon href=https://erikmcclure.com/favicon.ico><link rel=stylesheet href=https://erikmcclure.com/css/main.css><link rel=stylesheet href=https://erikmcclure.com/css/prism.css rel=stylesheet><link rel=stylesheet href=https://erikmcclure.com/css/katex.min.css rel=stylesheet><link rel=stylesheet href=https://erikmcclure.com/css/fontawesome.min.css><link rel=stylesheet href=https://erikmcclure.com/css/regular.min.css><link rel=stylesheet href=https://erikmcclure.com/css/brands.min.css><link rel=stylesheet href=https://erikmcclure.com/css/solid.min.css><link rel=alternate type=application/rss+xml title="Erik McClure - RSS" href=https://erikmcclure.com/blog/index.xml><meta property="og:type" content="website"><title>Blogs - Erik McClure</title><meta property="og:title" content="Blogs - Erik McClure"><meta name=twitter:title content="Blogs - Erik McClure"><meta itemprop=name content="Blogs - Erik McClure"><meta name=description content="Applied mathematician and software architect who occasionally writes music."><meta property="og:description" content="Applied mathematician and software architect who occasionally writes music."><meta name=twitter:description content="Applied mathematician and software architect who occasionally writes music."><meta itemprop=description content="Applied mathematician and software architect who occasionally writes music."><meta property="og:url" content="https://erikmcclure.com/"><meta property="og:site_name" content="Erik McClure"><meta property="og:image" content="https://erikmcclure.com/img/avatar.png"><meta property="og:locale" content="en-US"><meta property="article:author" content="Erik McClure"><meta name=twitter:card content="summary"><meta name=twitter:site content="@erikmcclure0173"><meta name=twitter:creator content="@erikmcclure0173"><meta name=twitter:image content="https://erikmcclure.com/img/avatar.png"><meta name=twitter:dnt content="on"><link href=https://plus.google.com/104896885003230920472 rel=publisher><meta itemprop=image content="https://erikmcclure.com/img/avatar.png"><meta name=last-updated content="20250430-05:35:00.000"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-63026815-3"></script>
<script defer src=https://erikmcclure.com/syntax-prism.js></script>
<script defer src=https://erikmcclure.com/katex.min.js></script>
<script defer src=https://erikmcclure.com/mathtex-script-type.min.js></script>
<script defer src=https://erikmcclure.com/auto-render.min.js></script>
<script defer src=https://cdn.commento.io/js/count.js></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-63026815-3")</script></head><body><div id=container><header><nav><ul><li><a href=/blog/ title=Blog><i class="fa-solid fa-book fa-fw fa-lg"></i>&nbsp;<p>Blog</p></a></li><li><a href=/projects/ title=Projects><i class="fa-solid fa-briefcase fa-fw fa-lg"></i>&nbsp;<p>Projects</p></a></li><li><a href=https://erikmcclure.bandcamp.com title=Bandcamp><i class="fa-brands fa-bandcamp fa-fw fa-lg"></i>&nbsp;<p>Bandcamp</p></a></li><li><a href=https://github.com/erikmcclure title=Github><i class="fa-brands fa-github fa-fw fa-lg"></i>&nbsp;<p>Github</p></a></li><li><a href=/web/ title=Websites><i class="fa-solid fa-globe fa-fw fa-lg"></i>&nbsp;<p>Websites</p></a></li></ul></nav><div class=dim><h1>Erik McClure</h1></div></header><main class=blog><section><article><h4><a href=/blog/pressure-based-anti-spam-for-discord-bots/>Pressure Based Anti-Spam for Discord Bots</a></h4><hr><div class=padding><p>Back when Discord was a wee little chat platform with no rate limiting whatsoever, it&rsquo;s API had already been reverse-engineered by a bunch of bot developers who then went around spamming random servers with so many messages it would crash the client. My friends and I were determined to keep our discord server public, so I went about creating the first anti-spam bot for Discord.</p><p>I am no longer maintaining this bot beyond simple bugfixes because I have better things to do with my time, and I&rsquo;m tired of people trying to use it because &ldquo;it&rsquo;s the best anti-spam bot&rdquo; even after I deprecated it. This post is an effort to educate all the other anti-spam bots on how to ascend beyond a simple &ldquo;mute someone if they send more than N messages in M seconds&rdquo; filter and hopefully make better anti-spam bots so I don&rsquo;t have to.</p><h2 id=architecture>Architecture</h2><p>There are disagreements over exactly how an anti-spam bot should work, with a wide-range of preferred behaviors that differ between servers, depending on the community, size of the server, rate of growth of the server, and the administrators personal preferences. Many anti-spam solutions lock down the server by forcing new members to go through an airlock channel, but I consider this overkill and the result of poor anti-spam bots that are bad at actually stopping trolls or responding to raids.</p><p>My moderation architecture goes like this:<br><pre><code>-- Channels --  
#Moderation Channel  
#Raid Containment  
#Silence Containment  
#Log Channel

-- Roles --  
@Member  
@Silence  
@New</code></pre></p><p>When first-time setup is run on a server, the bot queries and stores all the permissions given to the <code>@everyone</code> role. It adds all these permissions to the <code>@Member</code> role, then goes through all existing users and adds the <code>@Member</code> role to them. It then <strong>removes all permissions from <code>@everyone</code></strong>, but adds an override for <code>#Raid Containment</code> so that anyone without the <code>@Member</code> role can only speak in <code>#Raid Containment</code>.</p><p>Then, it creates the <code>@Silence</code> role by adding permission overrides to every single channel on the server that prevent you from <em>sending</em> messages on that channel, except for the <code>#Silence Containment</code> channel. This ensures that, no matter what new roles might be added in the future, <code>@Silence</code> will always prevent you from sending messages on any channel other than <code>#Silence Containment</code>. The admins of the server can configure the visibility of the containment channels. Most servers make it so <code>#Raid Containment</code> is only visible to anyone without the <code>@Member</code> role, ensure <code>#Silence Containment</code> is only visible to anyone with the <code>@Silence</code> role, and hide <code>#Log Channel</code> from everyone except admins.</p><p>This architecture was chosen to allow the bot to survive a mega-raid, so that even if 500+ bot accounts storm the server all at once, if the bot goes down or is rate-limited, they can&rsquo;t do anything because they haven&rsquo;t been given the <code>@Member</code> role, and so the server is protected by default. This is essentially an automated airlock that only engages if the bot detects a raid, instead of forcing all new members to go through the airlock. Some admins do not like this approach because they prefer to personally audit every new member, but this is not viable for larger servers.</p><p>The <code>@Member</code> role being added can also short-circuit Discord&rsquo;s own verification rules, which is an unfortunate consequence, but in practice it usually isn&rsquo;t a problem. However, to help compensate for this, the bot can also be configured to add a temporary <code>@New</code> role to newer users that expires after a configurable amount of time. What this role actually does is up to the administrators - usually it simply disables sharing images or embeds.</p><h2 id=operation>Operation</h2><p>The bot has two distinct modes of operation. Under normal operation, when a new member joins the server, they are automatically given <code>@Member</code> (and <code>@New</code> if it&rsquo;s been enabled) and are immediately allowed to speak. If they trigger the anti-spam, or a moderator uses the <code>!silence</code> command, they will have the <code>@Silence</code> role added, any messages sent in the last 5 seconds (by default) will be deleted, and they&rsquo;ll be restricted to speaking in <code>#Silence Containment</code>. By default, silences that happen automatically are never rescinded until a moderator manually unsilences someone. However, some server admins are lazy, so an automatic expiration can be added. A manual silence can also be configured to expire after a set period of time. If a user triggers the anti-spam filter again <em>while they are in the containment channel</em>, then the bot will automatically ban them.</p><p>It&rsquo;s important to note that when silenced, users have <strong>both</strong> the <code>@Member</code> and the <code>@Silence</code> role. The reason is because many servers have opt-in channels that are only accessible if you add a role to yourself. Simply removing <code>@Member</code> would not suffice to keep them from talking in these channels, but <code>@Silence</code> can override these permissions and ensure they can&rsquo;t speak in any channel without having to mess up anyone&rsquo;s assigned roles.</p><p>The bot detects a raid if <code>N</code> joins happen within <code>M</code> seconds. It&rsquo;s usually configured to be something like <code>3</code> joins in a <code>90</code> second interval for an active server. When this happens, the server enters <strong>raid mode</strong>, which automatically removes <code>@Member</code> from all the users that just triggered the raid alert. It sends a message pinging the moderators in <code>#Moderator Channel</code> and stops adding <code>@Member</code> to anyone who joins while it is still in raid mode. It also changes the server verification level, which actually does have an effect for the newly joined members, because they haven&rsquo;t had any roles assigned to them yet. Moderators can either cancel the raid alert, which automatically adds <code>@Member</code> to everyone who was detected as part of the raid alert, or they can individually add <code>@Member</code> to people they have vetted. The raid mode automatically ends after <code>M*2</code> seconds, which would be <code>180</code> in this example. A moderator can use a command to ban everyone who joined during the raid alert, or they can selectively add <code>@Member</code> to users who should be let in.</p><p>This method of dealing with raids ensures that the bot cannot be overwhelmed by the sheer number of joins. If it crashes or is taken down, the server stays in raid mode until the bot can recover, and the potential raiders will not be allowed in.</p><h2 id=pressure-system>Pressure System</h2><p>All the anti-spam logic in the bot is done by triggering an automatic silence, which gives someone the <code>@Silence</code> role. The bot determines when to silence someone by analyzing all the messages being sent using a pressure system. In essence, the pressure system is analogous to the gravity function used for calculating the &ldquo;hotness&rdquo; of a given post on a site like <a href=https://medium.com/hacking-and-gonzo/how-hacker-news-ranking-algorithm-works-1d9b0cf2c08d>Hacker News</a>.</p><p>Each message a user sends is assigned a &ldquo;pressure score&rdquo;. This is calculated from the message length, contents, whether it matches a filter, how many newlines it has, etc. This &ldquo;pressure&rdquo; is designed to simulate how <em>disruptive</em> the message is to the current chat. A wall of text is extremely disruptive, whereas saying &ldquo;hi&rdquo; probably isn&rsquo;t. Attaching 3 images to your message is very disruptive, but embedding a single link isn&rsquo;t that bad. Sending a blank message with 2000 newlines is <em>incredibly</em> disruptive, whereas sending a message with two paragraphs is probably fine. In addition, all messages are assigned a <em>base pressure</em>, the minimum amount of pressure that any message will have, even if it&rsquo;s only a single letter.</p><p>My bot looks at the following values:</p><ul><li><strong>Max Pressure</strong>: The default maximum pressure is 60.</li><li><strong>Base Pressure</strong>: All messages generate 10 pressure by default, so at most 6 messages can be sent at once.</li><li><strong>Embed Pressure</strong>: Each image, link, or attachment in a message generates 8.3 additional pressure, which limits users to 5 images or links in a single message.</li><li><strong>Length Pressure</strong>: Each individual character in a message generates 0.00625 additional pressure, which limits you to sending 2 maximum length messages at once.</li><li><strong>Line Pressure</strong>: Each newline in a message generates 0.714 additional pressure, which limits you to 70 newlines in a single message.</li><li><strong>Ping Pressure</strong>: Every single <em>unique</em> ping in a message generates 2.5 additional pressure, which limits users to 20 pings in a single message.</li><li><strong>Repeat Pressure</strong>: If the message being sent is the <em>exact</em> same as the previous message sent by this user (copy+pasted), it generates 10 additional pressure, effectively doubling the base pressure cost for the message. This means a user copy and pasting the same message more than twice in rapid succession will be silenced.</li><li><strong>Filter Pressure</strong>: Any filter set by the admins can add an arbitrary amount of additional pressure if a message triggers that filter regex. The amount is user-configurable.</li></ul><p>And here a simplified version of my implementation. Note that I am adding the pressure piecewise, so that I can alert the moderators and tell them exactly which pressure trigger broke the limit, which helps moderators tell if someone just posted too many pictures at once, or was spamming the same message over and over:<pre class=language-go><code>if w.AddPressure(info, m, track, info.Config.Spam.BasePressure) {
	return true
}
if w.AddPressure(info, m, track, info.Config.Spam.EmbedPressure*float32(len(m.Attachments))) {
	return true
}
if w.AddPressure(info, m, track, info.Config.Spam.EmbedPressure*float32(len(m.Embeds))) {
	return true
}
if w.AddPressure(info, m, track, info.Config.Spam.LengthPressure*float32(len(m.Content))) {
	return true
}
if w.AddPressure(info, m, track, info.Config.Spam.LinePressure*float32(strings.Count(m.Content, &#34;\n&#34;))) {
	return true
}
if w.AddPressure(info, m, track, info.Config.Spam.PingPressure*float32(len(m.Mentions))) {
	return true
}
if len(m.Content) &gt; 0 &amp;&amp; m.Content == track.lastcache {
	if w.AddPressure(info, m, track, info.Config.Spam.RepeatPressure) {
		return true
	}
}</code></pre>Once we&rsquo;ve calculated how disruptive a given message is, we can add it to the user&rsquo;s total pressure score, which is a measure of how disruptive a user is currently being. However, we need to recognize that sending a wall of text every 10 minutes probably isn&rsquo;t an issue, but sending 10 short messages saying &ldquo;ROFLCOPTER&rdquo; in 10 seconds is definitely spamming. So, before we add the message pressure to the user&rsquo;s pressure, we check how long it&rsquo;s been since that user last sent a message, and <em>decrease their pressure accordingly</em>. If it&rsquo;s only been a second, the pressure shouldn&rsquo;t decrease very much, but if it&rsquo;s been 3 minutes or so, any pressure they used to have should probably be gone by now. Most heat algorithms do this non-linearly, but my experiments showed that a linear drop-off tends to produce better results (and is simpler to implement).</p><p>My bot implements this by simply decreasing the amount of pressure a user has by a set amount for every <code>N</code> seconds. So if it&rsquo;s been 2 seconds, they will lose <code>4</code> pressure, until it reaches zero. Here is the implementation for my bot, which is done before any pressure is added:<br><pre class=language-go><code>timestamp := bot.GetTimestamp(m)
track := w.TrackUser(author, timestamp)
last := track.lastmessage
track.lastmessage = timestamp.Unix()*1000 + int64(timestamp.Nanosecond()/1000000)
if track.lastmessage &lt; last { // This can happen because discord has a bad habit of re-sending timestamps if anything so much as touches a message
	track.lastmessage = last
	return false // An invalid timestamp is never spam
}
interval := track.lastmessage - last

track.pressure -= info.Config.Spam.BasePressure * (float32(interval) / (info.Config.Spam.PressureDecay * 1000.0))
if track.pressure &lt; 0 {
	track.pressure = 0
}</code></pre>In essence, this entire system is a superset of the more simplistic &ldquo;<code>N</code> messages in <code>M</code> seconds&rdquo;. If you only use base pressure and maximum pressure, then these determine the absolute upper limit of how many messages can be send in a given time period, regardless of their content. You then tweak the rest of the pressure values to more quickly catch obvious instances of spamming. The maximum pressure can be altered on a per-channel basis, which allows meme channels to spam messages without triggering anti-spam. Here&rsquo;s what a user&rsquo;s pressure value looks like over time:</p><div class=imgwrap style=max-width:481px><a href=/img/pressure.png target=_blank><img src=/img/pressure.png alt="Pressure Graph" width=100%></a></div><p>Because this whole pressure system is integrated into the Regex filtering module, servers can essentially create their own bad-word filters by assigning a huge pressure value to a certain match, which instantly creates a silence. These regexes can be used to look for other things that the bot doesn&rsquo;t currently track, like all-caps messages, or for links to specific websites. The pressure system allows integrating all of these checks in a unified way that represents the total &ldquo;disruptiveness&rdquo; of an individual user&rsquo;s behavior.</p><h2 id=worst-case-scenario>Worst Case Scenario</h2><p>A special mention should go to the uncommon but possible worst-case scenario for spamming. This happens when a dedicated attacker really, really wants to fuck up your server for some reason. They can do this by creating 1000+ fake accounts with randomized names, and wait until they&rsquo;ve all been on discord for long enough that the &ldquo;new to discord&rdquo; message doesn&rsquo;t show up. Then, they have the bots join the server <em>extremely slowly</em>, at the pace of maybe 1 per hour. Then they wait another week or so, before they unleash a spam attack that has each account send exactly 1 message, followed by a different account sending another message.</p><p>If they do this fast enough, you can detect it simply by the sheer volume of messages being sent in the channel, and automatically put the channel in slow mode. However, in principle, it is completely impossible to automatically deal with this attack. Banning everyone who happens to be sending messages during the spam event will ban innocent bystanders, and if the individual accounts aren&rsquo;t sending messages that fast (maybe one per second), this is indistinguishable from a normal rapid-fire conversation.</p><p>My bot has an emergency method for dealing with this where it tracks when a given user sent their first message in the server. You can then use a command to ban everyone who sent their first message in the past <code>N</code> seconds. This is very effective when it works, but it is trivial for spammers to get past once they realize what&rsquo;s going on - all they need to do is have their fake accounts say &ldquo;hi&rdquo; once while they&rsquo;re trickling in. Of course, a bunch of accounts all saying &ldquo;hi&rdquo; and then nothing else may raise enough suspicion to catch the attack before it happens.</p><h2 id=conclusion>Conclusion</h2><p>Hopefully this article demonstrates how to make a reliable, extensible anti-spam bot that can deal with pretty much any imaginable spam attack. The code for my deprecated spam bot is <a href=https://github.com/ErikMcClure/sweetiebot>available here</a> for reference, but the code is terrible and most of it was a bad idea. You cannot add the bot itself to a server anymore, and the support channel is no longer accessible.</p><p>My hope is that someone can use these guidelines to build a much more effective anti-spam bot, and release me from my torment. I hate web development and I&rsquo;d rather spend my time building a native webassembly compiler instead of worrying about <a href=https://github.com/bwmarrin/discordgo/issues/659>weird intermittent cloudflare errors</a> that temporarily break everything, or <a href=https://github.com/bwmarrin/discordgo/issues/513>badly designed lock systems</a> that deadlock under rare edge cases. Godspeed, bot developers.</p></div><hr><time itemprop=datePublished pubdate=pubdate datetime=2020-01-15T21:45:00+00:00><i class="fa-regular fa-clock fa-fw"></i>&nbsp;Published on <a href=https://erikmcclure.com/blog/pressure-based-anti-spam-for-discord-bots/>January 15, 2020 at 9:45pm</a></time><aside><i class="fa-regular fa-comments fa-fw"></i>&nbsp;<a href=/blog/pressure-based-anti-spam-for-discord-bots/#commento> comments</a></aside><aside><i class="fa-regular fa-share-square fa-fw"></i>&nbsp;share:<ul><li><a href="javascript:window.open('https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ferikmcclure.com%2fblog%2fpressure-based-anti-spam-for-discord-bots%2f','popup','width=600,height=400');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><path class="st0" d="M16.75 9H13.5V7a1 1 0 011-1h2V3H14a4 4 0 00-4 4V9H8v3h2v9h3.5V12H16z"/></svg></a><li><a href="javascript:window.open('https://twitter.com/intent/tweet?text=Pressure%20Based%20Anti-Spam%20for%20Discord%20Bots&url=https%3a%2f%2ferikmcclure.com%2fblog%2fpressure-based-anti-spam-for-discord-bots%2f','popup','width=600,height=256');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><path class="st0" opacity="0" d="M0 0h24v24H0z"/><path class="st0" d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572.0-4.658 2.086-4.658 4.66.0.364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342.0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3.0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376.0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57.0 13.255-7.098 13.255-13.254.0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/></svg></a></li><li><a href="javascript:window.open('https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2ferikmcclure.com%2fblog%2fpressure-based-anti-spam-for-discord-bots%2f','popup','width=700,height=380');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><rect class="st0" height="11" width="4" x="3" y="9"/><circle class="st0" cx="5" cy="5" r="2"/><path class="st0" d="M16.5 8.25A4.47251 4.47251.0 0013 9.95343V9H9V20h4V13a2 2 0 014 0v7h4V12.75a4.5 4.5.0 00-4.5-4.5z"/></svg></a></li></ul></aside></article><article><h4><a href=/blog/name-shadowing-should-be-an-operator/>Name Shadowing Should Be An Operator</a></h4><hr><div class=padding><p>I recently discovered that in Rust, this is a relatively common operation:<pre class=language-rust><code>let foo = String::from(&#34;foo&#34;);
// stuff that needs ownership
let foo = &amp;foo;  
</code></pre>Or this:<pre class=language-rust><code>let mut vec = Vec::new();
vec.push(&#34;a&#34;);
vec.push(&#34;b&#34;);
let vec = vec; /* vec is immutable now */  
</code></pre>This is a particularly permissive form of <strong>name-shadowing</strong>, which allows you to re-declare a variable in an inner scope that <em>shadows</em> the name of a variable in an outer scope, making the outer variable inaccessible. Almost every single programming language in common use allows you to do this in some form or another. Rust goes a step further and lets you re-declare a variable <em>inside the same scope</em> as another variable.</p><p>This, to me, is pretty terrifying, because name-shadowing itself is often a dangerous operation. 90% of the time, name-shadowing causes problems with either temporary or index variables, such as <code>i</code>. These are all cases where almost you never want to name-shadow anything and doing so is probably a mistake.<pre class=language-cpp><code>for(int i = 0; i &lt; width; ++i)
{
  for(int j = 0; j &lt; height; ++j)
  {
    //
    // lots of unrelated code
    //
    
    float things[4] = {1,2,3,4};
    for(int i = 0; i &lt; 4; ++i)
    	box[i][j] += things[i] // oops!
    //      ^ that is the wrong variable!
  }
}
</code></pre>These errors almost always crop up in complex for loop scenarios, which can obviously be avoided with iterators, but this isn&rsquo;t always an option, espiecally in a lower-level systems programming language like Rust. Even newer languages like Go make it alarmingly easy to name-shadow, although they make it a lot harder to accidentally shoot yourself because unused variables are a compiler error:<pre class=language-rust><code>foo, err := func()
if err != nil {
	err := bar(foo) // error: err is not used
}
println(err)
</code></pre>Unfortunately, Rust doesn&rsquo;t have this error, only an <code>unused-variables</code> linter warning. If you want, you can add <code>#![deny(clippy::shadow_unrelated)]</code> to be warned about name-shadowing. However, a lot of Rust idioms <em>depend</em> on the ability to name-shadow, because Rust does a lot of type-reassignment, where the contents of a variable don&rsquo;t change, but in a particular scope, the known type of the variable has changed to something more specific.<pre class=language-rust><code>let foo = Some(5);
match foo {
    Some(foo) =&gt; println!(&#34;{}&#34;, foo),
    None =&gt; {},
}
</code></pre>Normally, in C++, I avoid name-shadowing at all costs, but this is partially because C++ shadowing rules are unpredictable or counter-intuitive. Rust, however, seems to have legitimate use cases for name-shadowing, which would be reasonable if name-shadowing could be made more explicit.</p><p>I doubt Rust would want to change it&rsquo;s syntax, but if I were to work on a new language, I would define an explicit <strong>name-shadowing operator</strong>, either as a keyword or as an operator. This operator would redefine a variable as a new type and throw a compiler error if there is no existing variable to redefine. Attempting to redefine a variable without this operator would also throw a compiler error, so you&rsquo;d have something like:<pre class=language-rust><code>let foo = String::from(&#34;foo&#34;);
// stuff that needs ownership
foo := &amp;foo;
</code></pre>Or alternatively:<pre class=language-rust><code>let mut vec = Vec::new();
vec.push(&#34;a&#34;);
vec.push(&#34;b&#34;);
shadow vec = vec; /* vec is immutable now */
</code></pre>While the <code>:=</code> operator is cleaner, the <code>shadow</code> keyword would be easier to embed in other constructions:<pre class=language-rust><code>let foo = Some(5);
match foo {
    Some(shadow foo) =&gt; println!(&#34;{}&#34;, foo),
    None =&gt; {},
}
</code></pre>Which method would depend on the idiomatic constructions in the language syntax, but by making name-shadowing an explicit, rather than an implicit action, this allows you to get the benefits of name-shadowing while eliminating most of the dangerous situations it can create.</p><p>Unfortunately, most modern language design seems hostile to any feature that even slightly inconveniences a developer for the sake of code safety and reliability. Perhaps a new language in the future will take these lessons to heart, but in the meantime, people will continue complaining about unstable software, at least until we put the &ldquo;engineer&rdquo; back in &ldquo;software engineering&rdquo;.</p></div><hr><time itemprop=datePublished pubdate=pubdate datetime=2019-10-13T13:23:58-07:00><i class="fa-regular fa-clock fa-fw"></i>&nbsp;Published on <a href=https://erikmcclure.com/blog/name-shadowing-should-be-an-operator/>October 13, 2019 at 1:23pm</a></time><aside><i class="fa-regular fa-comments fa-fw"></i>&nbsp;<a href=/blog/name-shadowing-should-be-an-operator/#commento> comments</a></aside><aside><i class="fa-regular fa-share-square fa-fw"></i>&nbsp;share:<ul><li><a href="javascript:window.open('https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ferikmcclure.com%2fblog%2fname-shadowing-should-be-an-operator%2f','popup','width=600,height=400');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><path class="st0" d="M16.75 9H13.5V7a1 1 0 011-1h2V3H14a4 4 0 00-4 4V9H8v3h2v9h3.5V12H16z"/></svg></a><li><a href="javascript:window.open('https://twitter.com/intent/tweet?text=Name%20Shadowing%20Should%20Be%20An%20Operator&url=https%3a%2f%2ferikmcclure.com%2fblog%2fname-shadowing-should-be-an-operator%2f','popup','width=600,height=256');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><path class="st0" opacity="0" d="M0 0h24v24H0z"/><path class="st0" d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572.0-4.658 2.086-4.658 4.66.0.364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342.0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3.0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376.0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57.0 13.255-7.098 13.255-13.254.0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/></svg></a></li><li><a href="javascript:window.open('https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2ferikmcclure.com%2fblog%2fname-shadowing-should-be-an-operator%2f','popup','width=700,height=380');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><rect class="st0" height="11" width="4" x="3" y="9"/><circle class="st0" cx="5" cy="5" r="2"/><path class="st0" d="M16.5 8.25A4.47251 4.47251.0 0013 9.95343V9H9V20h4V13a2 2 0 014 0v7h4V12.75a4.5 4.5.0 00-4.5-4.5z"/></svg></a></li></ul></aside></article><article><h4><a href=/blog/a-rant-on-terra/>A Rant On Terra</a></h4><hr><div class=padding><p>Metaprogramming, or the ability to inspect, modify and generate code at compile-time (as opposed to reflection, which is runtime introspection of code), has slowly been gaining momentum. Programmers are finally admitting that, after <a href=https://en.wikipedia.org/wiki/Template_metaprogramming>accidentally inventing turing complete template systems</a>, maybe we should just have proper first-class support for generating code. <a href=https://doc.rust-lang.org/1.2.0/book/macros.html>Rust has macros</a>, Zig has <a href=https://ziglang.org/documentation/master/#Compile-Time-Expressions>built-in compile time expressions</a>, Nim lets you <a href=https://nim-lang.org/docs/macros.html>rewrite the AST</a> however you please, and <a href=https://en.wikipedia.org/wiki/Dependent_type>dependent types</a> have been cropping up all over the place. However, with great power comes <del>great responsibility</del> undecidable type systems, whose undefined behavior may involve summoning eldritch abominations from the Black Abyss of Rěgne Ūt.</p><p>One particular place where metaprogramming is particularly useful is low-level, high-performance code, which is what <a href=http://terralang.org/>Terra</a> was created for. The idea behind Terra is that, instead of crafting ancient runes inscribed with infinitely nested variadic templates, just replace the whole thing with an actual turing-complete language, like say, <a href=https://www.lua.org/>Lua</a> (technically including <a href=http://luajit.org/>LuaJIT</a> extensions for FFI). This all sounds nice, and no longer requires a circle of salt to ward off demonic syntax, which Terra is quick to point out. They espouse the magical wonders of replacing your metaprogramming system with an actual scripting language:</p><blockquote><p>In Terra, we just gave in to the trend of making the meta-language of C/C++ more powerful and replaced it with a real programming language, Lua.</p><p>The combination of a low-level language meta-programmed by a high-level scripting language allows many behaviors that are not possible in other systems. Unlike C/C++, Terra code can be JIT-compiled and run interleaved with Lua evaluation, making it easy to write software libraries that depend on runtime code generation.</p><p>Features of other languages such as conditional compilation and templating simply fall out of the combination of using Lua to meta-program Terra</p></blockquote><p>Terra even claims you can implement Java-like OOP inheritance models as libraries and drop them into your program. It may also cure cancer (the instructions were unclear).</p><blockquote><p>As shown in the templating example, Terra allows you to define methods on struct types but does not provide any built-in mechanism for inheritance or polymorphism. Instead, normal class systems can be written as libraries. More information is available in our PLDI Paper.</p><p>The file lib/javalike.t has one possible implementation of a Java-like class system, while the file lib/golike.t is more similar to Google’s Go language.</p></blockquote><p>I am here to warn you, traveler, that <strong>Terra sits on a throne of lies</strong>. I was foolish. I was taken in by their audacious claims and fake jewels. It is only when I finally sat down to dine with them that I realized I was surrounded by nothing but cheap plastic and slightly burnt toast.</p><h2 id=the-bracket-syntax-problem>The Bracket Syntax Problem</h2><p>Terra exists as a syntax extension to Lua. This means it adds additional keywords on top of Lua&rsquo;s existing grammar. Most languages, when extending a syntax, would go to great lengths to ensure the new grammar does not create any ambiguities or otherwise interfere with the original syntax, treating it like a delicate flower that mustn&rsquo;t be disturbed, lest it lose a single petal.</p><p>Terra takes the flower, gently places it on the ground, and then stomps on it, repeatedly, until the flower is nothing but a pile of rubbish, as dead as the dirt it grew from. Then it sets the remains of the flower on fire, collects the ashes that once knew beauty, drives to a nearby cliffside, and throws them into the uncaring ocean. It probably took a piss too, but I can&rsquo;t prove that.</p><p>To understand why, one must understand what the escape operator is. It allows you to splice an abstract AST generated from a Lua expression directly into Terra code. Here is an example from Terra&rsquo;s website:<pre class=language-lua><code>function get5()
  return 5
end
terra foobar()
  return [ get5() + 1 ]
end
foobar:printpretty()
&gt; output:
&gt; foobar0 = terra() : {int32}
&gt; 	return 6
&gt; end</code></pre>But, wait, that means it&rsquo;s&mldr; the same as the array indexing operator? You don&rsquo;t mean you just put it inside like&ndash;</p><pre class=language-lua><code>local rest = {symbol(int),symbol(int)}

terra doit(first : int, [rest])
  return first + [rest[1]] + [rest[2]]
end</code></pre><p>What.</p><p><strong><em>WHAT?!</em></strong></p><p>You were supposed to banish the syntax demons, not join them! This <em>abomination</em> is an insult to Nine Kingdoms of Asgard! It is the very foundation that Satan himself would use to unleash Evil upon the world. Behold, mortals, for I come as the harbinger of <em>despair</em>:</p><pre class=language-lua><code>function idx(x) return `x end
function gen(a, b) return `array(a, b) end

terra test()
  -- Intended to evaluate to array(1, 2) 0
  return [gen(1, 2)][idx(0)]
end</code></pre><p>For those of you joining us (probably because you heard a blood-curdling scream from down the hall), this syntax is exactly as ambiguous as you might think. Is it two splice statements put next to each other, or is a splice statement with an array index? You no longer know if a splice operator is supposed to index the array or act as a splice operator, as <a href=https://github.com/StanfordLegion/legion/issues/522>mentioned in this issue</a>. Terra &ldquo;resolves this&rdquo; by just assuming that any two bracketed expressions put next to each other are <em>always</em> an array indexing operation, which is a lot like fixing your server overheating issue by running the fire suppression system all day. However, because this is Lua, whose syntax is very much like a delicate flower that cannot be disturbed, a much worse ambiguity comes up when we try to fix this.</p><pre class=language-lua><code>function idx(x) return `x end
function gen(a, b) return `array(a, b) end

terra test()
  -- This is required to make it evaluate to array(1,2)[0]
  -- return [gen(1, 2)][ [idx(0)] ]
  -- This doesn&#39;t work:
  return [gen(1, 2)][[idx(0)]]
  -- This is equivalent to:
  -- return [gen(1, 2)] &#34;idx(0)&#34;
end</code></pre><p>We want to use a spliced Lua expression as the array index, but if we don&rsquo;t use any spaces, <em>it turns into a string</em> because <code>[[string]]</code> is the Lua syntax for an unescaped string! Now, those of you who still possess functioning brains may believe that this would always result in a syntax error, as we have now placed a string next to a variable. <strong>Not so!</strong> Lua, in it&rsquo;s infinite wisdom, converts anything of the form <code>symbol"string"</code> or <code>symbol[[string]]</code> into a <strong>function call</strong> with the string as the only parameter. That means that, in certain circumstances, we literally attempt to <em>call our variable as a function with our expression as a string</em>:</p><pre class=language-lua><code>local lookups = {x = 0, y = 1, z = 2, w = 3 };
  vec.metamethods.__entrymissing = macro(function(entryname, expr)
    if lookups[entryname] then
      -- This doesn&#39;t work
      return `expr.v[[lookups[entryname]]]
      -- This is equivalent to
      -- return `expr.v &#34;lookups[entryname]&#34;
      -- But it doesn&#39;t result in a syntax error, becase it&#39;s equivalent to:
      -- return `extr.v(&#34;lookups[entryname]&#34;)
    else
      error &#34;That is not a valid field.&#34;
    end
  end)</code></pre><p>As a result, you get a <em>type error</em>, not a syntax error, and a very bizarre one too, because it&rsquo;s going to complain that <code>v</code> isn&rsquo;t a function. This is like trying to bake pancakes for breakfast and accidentally going scuba diving instead. It&rsquo;s not a sequence of events that should ever be related in any universe that obeys causality.</p><p>It should be noted that, after a friend of mine heard my screams of agony, <a href=https://github.com/zdevito/terra/issues/385>an issue was raised</a> to change the syntax to a summoning ritual that involves less self-mutilation. Unfortunately, this is a breaking change, and will probably require an exorcism.</p><h2 id=the-documentation-is-wrong>The Documentation Is Wrong</h2><p>Terra&rsquo;s documentation is so wrong that it somehow manages to be wrong in both directions. That is, some of the documentation is out-of-date, while some of it refers to concepts that never made it into <code>master</code>. I can only assume that a time-traveling gremlin was hired to write the documentation, who promptly got lost amidst the diverging timelines. It is a quantum document, both right and wrong at the same time, yet somehow always useless, a puzzle beyond the grasp of modern physics.</p><ul><li>The first thing talked about in the <a href=http://terralang.org/api.html#lua-api>API Reference</a> is a List object. It does not actually exist. A <a href=https://github.com/zdevito/terra/blob/aa19f1ab6e70f9710a3d140219f100cc75e59462/src/asdl.lua#L1>primitive incarnation of it</a> does exist, but it only implements <code>map()</code> and <code>insertall()</code>. Almost the entire section is completely wrong for the <code>1.0.0-beta1</code> release. The actual List object being described <a href=https://github.com/zdevito/terra/blob/develop/src/terralist.lua>sits alone and forgotten</a> in the develop branch, dust already beginning to collect on it&rsquo;s API calls, despite those API calls being the ones in the documentation&mldr; somehow.</li><li><code>:printpretty()</code> is a function that prints out a pretty string representation of a given piece of Terra code, by parsing the AST representation. On it&rsquo;s face, it does do exactly what is advertised: it prints a string. However, one might assume that it <em>returns</em> the string, or otherwise allows you to do something with it. This doesn&rsquo;t happen. It literally calls the <code>print()</code> function, throwing the string out the window and straight into the <code>stdout</code> buffer without a care in the world. If you want the <em>actual string</em>, you must call either <code>layoutstring()</code> (for types) or <code>prettystring()</code> (for quotes). Neither function is documented, anywhere.</li><li>Macros can only be called from inside Terra code. Unless you give the constructor two parameters, where the second parameter is a function called from inside a Lua context. This behavior is not mentioned in any documentation, anywhere, which makes it even more confusing when someone defines a macro as <code>macro(myfunction, myfunction)</code> and then calls it from a Lua context, which, according to the documentation, should be impossible.</li><li>Struct fields are not specified by their name, but rather just held in a numbered list of {name, type} pairs. This <em>is</em> documented, but a consequence of this system is not: Struct field names do not have to be unique. They can all be the same thing. Terra doesn&rsquo;t actually care. You can&rsquo;t actually be sure that any given field name lookup will result in, y&rsquo;know, <em>one field</em>. Nothing mentions this.</li><li>The documentation for saveobj is a special kind of infuriating, because everything is <em>technically</em> correct, yet it does not give you any examples and instead simply lists a function with 2 arguments and 4 interwoven optional arguments. In reality it&rsquo;s absolutely trivial to use because you can ignore almost all the parameters. Just write <code>terralib.saveobj("blah", {main = main})</code> and you&rsquo;re done. But there isn&rsquo;t a <em>single example of this</em> anywhere on the entire website. Only a paragraph and two sentences explaining in the briefest way possible how to use the function, followed by a highly technical example of how to initialize a custom target parameter, which <em>doesn&rsquo;t actually compile</em> because it has errant semicolons. This is literally <em>the most important function</em> in the entire language, because it&rsquo;s what actually compiles an executable!</li><li>The <code>defer</code> keyword is critical to being able to do proper error cleanup, because it functions similar to Go&rsquo;s defer by performing a function call at the end of a lexical scope. It is not documented, anywhere, or even mentioned at all on the website. How Terra manages to implement new functionality it forgets to document while, <em>at the same time</em>, documenting functionality <em>that doesn&rsquo;t exist yet</em> is a 4-dimensional puzzle fit for an extra-dimensional hyperintelligent race of aliens particularly fond of BDSM.</li><li>You&rsquo;d think that compiling Terra on Linux would be a lot simpler, but <a href=https://github.com/zdevito/terra/issues/393>you&rsquo;d be wrong</a>. Not only are the makefiles unreliable, but cmake itself doesn&rsquo;t seem to work with LLVM 7 unless you pass in <a href=https://github.com/zdevito/terra/blob/master/.travis.yml#L22>a very specific set of flags</a>, none of which are documented, because compiling via cmake <strong>isn&rsquo;t documented at all</strong>, and this is the <em>only way</em> to compile with LLVM 7 or above on the latest Ubuntu release!</li></ul><p>Perhaps there are more tragedies hidden inside this baleful document, but I cannot know, as I have yet to unearth the true depths of the madness lurking within. I am, at most, on the third or fourth circle of hell.</p><h2 id=terra-doesnt-actually-work-on-windows>Terra Doesn&rsquo;t Actually Work On Windows</h2><p>Saying that Terra supports Windows is a statement fraught with danger. It is a statement so full of holes that an entire screen door could try to sell you car insurance and it&rsquo;d still be a safer bet than running Terra on Windows. Attempting to use Terra on Windows will work if you have Visual Studio 2015 installed. It <em>might</em> work if you have Visual Studio 2013 installed. No other scenarios are supported, especially not ones that involve being productive. Actually <em>compiling</em> Terra on Windows is a hellish endeavor comparable to climbing Mount Everest in a bathing suit, which requires either having Visual Studio 2015 installed <em>to the default location</em>, or manually modifying a Makefile with the exact absolute paths of all the relevant dependencies. At least up until last week, when I <a href=https://github.com/zdevito/terra/pull/400>submitted a pull request</a> to minimize the amount of mountain climbing required.</p><p>The problem Terra runs into is that it tries to use a registry value to find the location of Visual Studio and then work out where <code>link.exe</code> is from there, then finds the include directories for the C runtime. This hasn&rsquo;t worked since Visual Studio 2017 and also requires custom handling for each version because compiling an iteration of Visual Studio apparently involves throwing the directory structure into the air, watching it land on the floor in a disorganized mess, and drawing lines between vaguely related concepts. Good for divining the true nature of the C library, bad for building directory structures. Unfortunately, should you somehow manage to compile Terra, it will abruptly stop working the moment you try to call <code>printf</code>, claiming that <code>printf</code> does not actually exist, even after importing <code>stdio.h</code>.</p><p>Many Terra tests assume that <code>printf</code> actually resolves to a concrete symbol. <a href="https://social.msdn.microsoft.com/Forums/vstudio/en-US/5150eeec-4427-440f-ab19-aecb26113d31/updated-to-vs-2015-and-now-get-unresolved-external-errors?forum=vcgeneral">This is not true</a> and hasn&rsquo;t been true since Visual Studio 2015, which turned several <code>stdio.h</code> functions into inline-only implementations. In general, the C standard library is under no obligation to produce an actual concrete symbol for any function - or to make sense to a mere mortal, for that matter. In fact, it might be more productive to assume that the C standard was wrought from the unholy, broiling chaos of the void by Cthulhu himself, who saw fit to punish any being foolish enough to make reasonable assumptions about how C works.</p><p>Unfortunately, importing <code>stdio.h</code> does not fix this problem, for two reasons. One, Terra did not understand inline functions on Windows. They were ephemeral wisps, <a href=https://github.com/zdevito/terra/issues/401>vanishing like a mote of dust on the wind</a> the moment a C module was optimized. A <a href=https://github.com/zdevito/terra/pull/405>pull request fixed this</a>, but it can&rsquo;t fix the fact that the Windows SDK was wrought from the innocent blood of a thousand vivisected COMDAT objects. Microsoft&rsquo;s version of <code>stdio.h</code> can only be described as an extra-dimensional object, a meta-stable fragment of a past universe that can only be seen in brief slivers, never all at once.</p><p>Luckily for the Terra project, I am the demonic presence they need, for I was once a Microsoftie. Long ago, I walked the halls of the Operating Systems Group and helped craft black magic to sate the monster&rsquo;s unending hunger. I saw True Evil blossom in those dark rooms, like having only three flavors of sparkling water and a pasta station only open on Tuesdays.</p><p>I know the words of Black Speech that must be spoken to reveal the true nature of Windows. I know how to bend the rules of our prison, to craft a mighty workspace from the bowels within. After <a href=https://github.com/zdevito/terra/pull/322>fixing the cmake implementation</a> to function correctly on Windows, I intend to perform <a href=https://gist.github.com/tonetheman/522b623d00e64cb5feda5d68252fa68a>the unholy incantations</a> required to invoke the almighty powers of COM, so that it may find on which fifth-dimensional hyperplane Visual Studio exists. Only then can I disassociate myself from the mortal plane for long enough to <a href=https://github.com/zdevito/terra/issues/401#issuecomment-537245442>tackle the <code>stdio.h</code> problem</a>. You see, children, programming for Windows is easy! All you have to do is <strong>s͏̷E͏l͏̢҉l̷ ̸̕͡Y͏o҉u͝R̨͘ ̶͝sơ̷͟Ul̴</strong></p><p>For those of you who actually wish to try Terra, but don&rsquo;t want to wait for <del>me to fix everything</del> a new release, you can embed the following code at the top of your root Terra script:</p><pre class=language-lua><code>if os.getenv(&#34;VCINSTALLDIR&#34;) ~= nil then
  terralib.vshome = os.getenv(&#34;VCToolsInstallDir&#34;)
  if not terralib.vshome then
    terralib.vshome = os.getenv(&#34;VCINSTALLDIR&#34;)
    terralib.vclinker = terralib.vshome..[[BIN\x86_amd64\link.exe]]
  else
    terralib.vclinker = ([[%sbin\Host%s\%s\link.exe]]):format(terralib.vshome, os.getenv(&#34;VSCMD_ARG_HOST_ARCH&#34;), os.getenv(&#34;VSCMD_ARG_TGT_ARCH&#34;))
  end
  terralib.includepath = os.getenv(&#34;INCLUDE&#34;)

  function terralib.getvclinker()
    local vclib = os.getenv(&#34;LIB&#34;)
    local vcpath = terralib.vcpath or os.getenv(&#34;Path&#34;)
    vclib,vcpath = &#34;LIB=&#34;..vclib,&#34;Path=&#34;..vcpath
    return terralib.vclinker,vclib,vcpath
  end
end</code></pre><p>Yes, we are literally overwriting parts of the compiler itself, at runtime, from our script. <strong>Welcome to Lua!</strong> Enjoy your stay, and don&rsquo;t let the fact that any script you run could completely rewrite the compiler keep you up at night!</p><h2 id=the-existential-horror-of-terra-symbols>The Existential Horror of Terra Symbols</h2><p>Symbols are one of the most slippery concepts introduced in Terra, despite their relative simplicity. When encountering a Terra Symbol, one usually finds it in a function that looks like this:</p><pre class=language-lua><code>TkImpl.generate = function(skip, finish) return quote
    if [TkImpl.selfsym].count == 0 then goto [finish] end 
    [TkImpl.selfsym].count = [TkImpl.selfsym].count - 1
    [stype.generate(skip, finish)]
end end</code></pre><p>Where <code>selfsym</code> is a symbol that was set elsewhere.</p><p>&ldquo;Aha!&rdquo; says our observant student, &ldquo;a reference to a variable from an outside context!&rdquo; This construct <em>does</em> let you access a variable from another area of the same function, and using it to accomplish that will generally work as you expect, but what it&rsquo;s actually doing is much <del>worse</del> more subtle. You see, grasshopper, a symbol is not a reference to a variable node in the AST, it is a reference to an <em>identifier</em>.</p><pre class=language-lua><code>local sym = symbol(int)
local inc = quote [sym] = [sym] + 1 end

terra foo()
  var [sym] = 0
  inc
  inc
  return [sym]
end

terra bar()
  var[sym] = 0
  inc
  inc
  inc
  return [sym]
end</code></pre><p>Yes, that is valid Terra, and yes, the people who built this language did this on purpose. Why any human being still capable of love would ever design such a catastrophe is simply beyond me. Each symbol literally represents not a reference to a variable, but a <em>unique variable name</em> that will refer to any variable that has been initialized in the current Terra scope with that particular identifier. You aren&rsquo;t passing around variable <em>references</em>, you&rsquo;re passing around variable <em>names</em>.</p><p>These aren&rsquo;t just symbols, they&rsquo;re <strong>typed preprocessor macros</strong>. They are literally C preprocessor macros, capable of causing just as much woe and suffering as one, except that they are typed and they can&rsquo;t redefine existing terms. This is, admittedly, <em>slightly</em> better than a normal C macro. However, seeing as there have been entire books written about humanity&rsquo;s collective hatred of C macros, this is equivalent to being a slightly more usable programming language than Brainfuck. This is such a low bar it&rsquo;s probably buried somewhere in the Mariana Trench.</p><h2 id=terra-is-c-but-the-preprocessor-is-lua>Terra is C but the Preprocessor is Lua</h2><p>You realize now, the monstrosity we have unleashed upon the world? The sin Terra has committed now lies naked before us.</p><p><strong>Terra is C if you replaced the preprocessor with Lua.</strong></p><p>Remember how Terra says you can implement Java-like and Go-like class systems? You can&rsquo;t. Or rather, you will end up with a pathetic imitation, a facsimile of a real class system, striped down to the bone and bereft of any useful mechanisms. It is nothing more than an implementation of vtables, just like you would make in C. Because Terra is C. It&rsquo;s metaprogrammable C.</p><p>There can be no constructors, or destructors, or automatic initialization, or any sort of borrow checking analysis, because Terra has no scoping mechanisms. The only thing it provides is <code>defer</code>, which only operates inside Lua lexical blocks (<code>do</code> and <code>end</code>)&mldr; sometimes, if you get lucky. The exact behavior is a bit confusing, and of course can only be divined by random experimentation because it <strong>isn&rsquo;t documented anywhere!</strong> Terra&rsquo;s only saving grace, the <em>singular keyword</em> that allows you to attempt to build some sort of pretend object system, <strong>isn&rsquo;t actually mentioned anywhere</strong>.</p><p>Of course, Terra&rsquo;s metaprogramming <em>is</em> turing complete, and it is <em>technically possible</em> to implement some of these mechanisms, but only if you either wrap absolutely every single variable declaration in a function, or you introspect the AST and annotate every single variable with initialization statuses and then run a metaprogram over it to figure out when constructors or destructors or assignment operators need to be called. Except, this might not work, because the (undocumented, of course) <code>__update</code> metamethod that is supposed to trigger when you assign something to a variable has a bug where it&rsquo;s not always called in all situations. This turns catching assignments and finding the l-value or r-value status from a mind-bogglingly difficult, herculean task, to a near-impossible trial of cosmic proportions that probably requires the help of at least two Avengers.</p><h2 id=there-is-no-type-system>There Is No Type System</h2><p>If Terra was actually trying to build a metaprogramming equivalent to templates, it would have an actual type system. These languages already exist - <a href=https://www.idris-lang.org/>Idris</a>, <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.121.4251">Omega</a>, <a href=https://www.fstar-lang.org/>F*</a>, <a href=https://en.wikipedia.org/wiki/Ada_(programming_language)>Ada</a>, <a href=https://sage.soe.ucsc.edu/>Sage</a>, etc. but none of them are interested in using their dependent type systems to actually metaprogram low-level code (although <a href=https://github.com/FStarLang/kremlin/blob/master/src/CFlatToWasm.ml>F* can produce it</a>). The problem is that building a recursively metaprogrammable type system requires building a proof assistant, and everyone is so proud of the fact they built a proof assistant they forget that dependent type systems can do other things too, like build really fast memcpy implementations.</p><p>Terra, on the other hand, provides only the briefest glimpse of a type system. Terra functions enjoy what is essentially a slightly more complex C type system. However, the higher-level Lua context is, well, Lua, which has five basic types: Tables, Functions, Strings, Booleans and Numbers (it also has Thread, Nil, Userdata and CData for certain edge cases). That&rsquo;s it. Also, it&rsquo;s dynamic, not static, so everything is a syntax or a runtime error, because it&rsquo;s a scripting language. This means all your metaprogramming is sprinkled with type-verification calls like <code>:istype()</code> or <code>:isstruct()</code>, except the top came off the shaker and now the entire program is just sprinkles, everywhere. This is fine for when your metaprograms are, themselves, relatively simple. It is not fine when you are returning meta-programs out of meta-meta-functions.</p><p>This is the impasse I find myself at, and it is the answer to the question I know everyone wants to know the answer to. For the love of heaven and earth and all that lies between, <strong>why am I still using Terra?</strong></p><p>The truth is that the project I&rsquo;m working on requires highly complex metaprogramming techniques in order to properly generate type-safe mappings for arbitrary data structures. Explaining <em>why</em> would be an entire blog post on it&rsquo;s own, but suffice to say, it&rsquo;s a complex user interface library that&rsquo;s intended to run on tiny embedded devices, which means I can&rsquo;t simply give up and use Idris, or indeed anything that involves garbage collection.</p><p>What I really want is a low-level, recursively metaprogrammable language that is also recursively type-safe, in that any type strata can safely manipulate the code of any layer beneath it, preferably via <a href=https://www.cl.cam.ac.uk/~sd601/thesis.pdf>algebriac subtyping</a> that ensures all types are recursively a subset of types that contain them, ad nauseam. This would then allow you to move from a &ldquo;low-level&rdquo; language to a &ldquo;high-level&rdquo; language by simply walking up the tower of abstraction, building meta-meta-programs that manipulate meta-programs that generate low-level programs.</p><p>Alas, such beauty can only exist in the minds of mathematicians and small kittens. While I may one day attempt to build such a language, it will be nothing more than a poor imitation, forever striving for an ideal it cannot reach, cursed with a vision from the gods of a pristine language no mortal can ever possess.</p><p>I wish to forge galaxies, to wield the power of computation and sail the cosmos upon an infinite wave of creativity. Instead, I spend untold hours toiling inside LLVM, wondering why it won&rsquo;t print &ldquo;Hello World&rdquo;.</p><p>In conclusion, everything is terrible and the universe is on fire.</p></div><hr><time itemprop=datePublished pubdate=pubdate datetime=2019-10-04T17:08:00+00:00><i class="fa-regular fa-clock fa-fw"></i>&nbsp;Published on <a href=https://erikmcclure.com/blog/a-rant-on-terra/>October 4, 2019 at 5:08pm</a></time><aside><i class="fa-regular fa-comments fa-fw"></i>&nbsp;<a href=/blog/a-rant-on-terra/#commento>3 comments</a></aside><aside><i class="fa-regular fa-share-square fa-fw"></i>&nbsp;share:<ul><li><a href="javascript:window.open('https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ferikmcclure.com%2fblog%2fa-rant-on-terra%2f','popup','width=600,height=400');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><path class="st0" d="M16.75 9H13.5V7a1 1 0 011-1h2V3H14a4 4 0 00-4 4V9H8v3h2v9h3.5V12H16z"/></svg></a><li><a href="javascript:window.open('https://twitter.com/intent/tweet?text=A%20Rant%20On%20Terra&url=https%3a%2f%2ferikmcclure.com%2fblog%2fa-rant-on-terra%2f','popup','width=600,height=256');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><path class="st0" opacity="0" d="M0 0h24v24H0z"/><path class="st0" d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572.0-4.658 2.086-4.658 4.66.0.364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342.0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3.0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376.0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57.0 13.255-7.098 13.255-13.254.0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/></svg></a></li><li><a href="javascript:window.open('https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2ferikmcclure.com%2fblog%2fa-rant-on-terra%2f','popup','width=700,height=380');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><rect class="st0" height="11" width="4" x="3" y="9"/><circle class="st0" cx="5" cy="5" r="2"/><path class="st0" d="M16.5 8.25A4.47251 4.47251.0 0013 9.95343V9H9V20h4V13a2 2 0 014 0v7h4V12.75a4.5 4.5.0 00-4.5-4.5z"/></svg></a></li></ul></aside></article><article><h4><a href=/blog/risc-is-fundamentally-unscalable/>RISC Is Fundamentally Unscalable</a></h4><hr><div class=padding><p>Today, there was an announcement about <a href=https://twitter.com/Calista_Redmond/status/1154278392344305664>a new RISC-V chip</a>, which has got a lot of people excited. I wish I could also be excited, but to me, this is just a reminder that RISC architectures are fundamentally unscalable, and inevitably stop being RISC as soon as they need to be fast. People still call ARM a &ldquo;RISC&rdquo; architecture despite <a href=https://en.wikipedia.org/wiki/ARM_architecture#ARMv8.3-A>ARMv8.3-A adding a <code>FJCVTZS</code> instruction</a>, which is &ldquo;Floating-point Javascript Convert to Signed fixed-point, rounding toward Zero&rdquo;. Reduced instruction set, my ass.</p><p>The reason this keeps happening is because <strong>the laws of physics</strong> ensure that no RISC architecture can scale under load. The problem is that a modern CPU is so fast that just accessing the L1 cache takes anywhere from <a href=https://www.7-cpu.com/cpu/Skylake_X.html>3-5 cycles</a>. This is part of the reason modern CPUs rely so much on <a href=https://en.wikipedia.org/wiki/Register_renaming>register renaming</a>, allowing them to have hundreds of internal registers that are used to make things go fast, as opposed to the paltry <a href=https://en.wikipedia.org/wiki/X86#/media/File:Table_of_x86_Registers_svg.svg>90 registers actually exposed</a>, 40 of which are just floating point registers for vector operations. The fundamental issue that CPU architects run into is that <strong>the speed of light isn&rsquo;t getting any faster</strong>. Even getting an electrical signal from one end of a CPU to the other now takes more than one cycle, which means the physical layout of your CPU now has a significant impact on how fast operations take. Worse, the faster the CPU gets, the more this lag becomes a problem, so unless you shrink the entire CPU or redesign it so your L1 and L2 caches are <em>physically closer to the transistors that need them</em>, the latency from accessing those caches can only go up, not down. The CPU might be getting faster, but the speed of light isn&rsquo;t.</p><p>Now, obviously RISC CPUs are very complicated architectures that do <a href=https://en.wikipedia.org/wiki/Classic_RISC_pipeline#Hazard>all sorts of insane pipelining</a> to try and execute as many instructions at the same time as possible. This is necessary because, unless your data is already loaded into registers, you might spend more cycles <em>loading data from the L1 cache</em> than doing the actual operation! If you hit the L2 cache, that will cost you 13-20 cycles by itself, and L3 cache hits are 60-100 cycles. This is made worse by the fact that complex floating-point operations can almost always be performed faster by encoding the operation in hardware, often in just one or two cycles, when manually implementing the same operation would&rsquo;ve taken 8 or more cycles. The <code>FJCVTZS</code> instruction mentioned above even <a href=https://community.arm.com/developer/ip-products/processors/b/processors-ip-blog/posts/armv8-a-architecture-2016-additions>sets a specific flag based on certain edge-cases</a> to allow an immediate jump instruction to be done afterwards, again to minimize hitting the cache.</p><p>All of this leads us to <strong>single instruction multiple data (SIMD)</strong> vector instructions common to almost all modern CPUs. Instead of doing a complex operation on a single float, they do a simple operation to many floats at once. The CPU can perform operations on 4, 8, or even 16 floating point numbers at the same time, in just 3 or 4 cycles, even though doing this for an individual float would have cost 2 or 3 cycles <em>each</em>. Even loading an array of floats into a large register will be faster than loading each float individually. There is no escaping the fact that attempting to run instructions one by one, even with fancy pipelining, will usually result in a CPU that&rsquo;s simply not doing anything most of the time. In order to make things go fast, you have to do things in bulk. This means having instructions that do as many things as possible, which is the exact opposite of how RISC works.</p><p>Now, this does not mean CISC is the future. We already invented a solution to this problem, which is <a href=https://en.wikipedia.org/wiki/Very_long_instruction_word>VLIW - Very Large Instruction Word</a>. This is what Itanium was, because researchers at HP anticipated this problem <a href=https://en.wikipedia.org/wiki/Itanium#Development:_1989%E2%80%932000>30 years ago</a> and teamed up with Intel to create what eventually became <a href=https://en.wikipedia.org/wiki/Itanium>Itanium</a>. In Itanium, or any VLIW architecture, you can tell the CPU to do <strong>many things at once</strong>. This means that, instead of having to build massive vector processing instructions or other complex specialized instructions, you can build your own mega-instructions out of a much simpler instruction set. This is great, because it simplifies the CPU design enormously while sidestepping the pipelining issues of RISC. The problem is that <em>this is really fucking hard to compile</em>, and that&rsquo;s what Intel screwed up. Intel assumed that compilers in 2001 could extract the instruction-level parallelism necessary to make VLIW work, but in reality we&rsquo;ve only <a href=https://arxiv.org/pdf/1902.02816.pdf>very recently figured out how to reliably do that</a>. 20 years ago, we weren&rsquo;t even close, so nobody could compile fast code for Itanium, and now Itanium is dead, even though it was specifically designed to solve our current predicament.</p><p>With that said, the <a href=https://en.wikipedia.org/wiki/Mill_architecture>MILL instruction set</a> uses VLIW along with several other innovations designed to compensate for a lot of the problems discussed here, like having <a href="https://www.youtube.com/watch?v=8E4qs2irmpc&amp;t=26m45s">deferred load instructions</a> to account for the lag time between requesting a piece of data and actually being able to use it (which, incidentally, also makes MILL immune to Spectre because it doesn&rsquo;t need to speculate). Sadly, MILL is currently still vaporware, having not materialized any actual hardware despite it&rsquo;s promising performance gains. One reason for this might be that any VLIW architecture has a highly unique instruction set. We&rsquo;re used to x86, which is so high-level it has almost nothing to do with the underlying CPU implementation. This is nice, because everyone implements the same instruction set and your programs all work on it, but it means the way instructions interact is hard to predict, much to the frustration of compiler optimizers. With VLIW, you would very likely have to recompile your program for <strong>every single unique CPU</strong>, which is a problem <a href=https://en.wikipedia.org/wiki/Mill_architecture#Family_traits>MILL has spent quite a bit of time on</a>.</p><p>MILL, and perhaps VLIW in general, may have a saving grace with <a href=https://webassembly.org/>WebAssembly</a>, precisely because it is a low-level assembly language that can be efficiently compiled to any architecture. It wouldn&rsquo;t be a problem to have unique instruction sets for every single type of CPU, because if you ship WebAssembly, you can simply compile the program for whatever CPU it happens to be running on. A lot of people miss this benefit of WebAssembly, even though I think it will be critical in allowing VLIW instruction sets to eventually proliferate. Perhaps MILL will see the light of day after all, or maybe someone else can come up with a VLIW version of RISC-V that&rsquo;s open-source. Either way, we need to stop pretending that pipelining RISC is going to work. It hasn&rsquo;t ever worked and it&rsquo;s not going to work, it&rsquo;ll just turn into another CISC with a javascript floating point conversion instruction.</p><p>Every. Single. Time.</p></div><hr><time itemprop=datePublished pubdate=pubdate datetime=2019-07-27T20:09:00+00:00><i class="fa-regular fa-clock fa-fw"></i>&nbsp;Published on <a href=https://erikmcclure.com/blog/risc-is-fundamentally-unscalable/>July 27, 2019 at 8:09pm</a></time><aside><i class="fa-regular fa-comments fa-fw"></i>&nbsp;<a href=/blog/risc-is-fundamentally-unscalable/#commento>10 comments</a></aside><aside><i class="fa-regular fa-share-square fa-fw"></i>&nbsp;share:<ul><li><a href="javascript:window.open('https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ferikmcclure.com%2fblog%2frisc-is-fundamentally-unscalable%2f','popup','width=600,height=400');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><path class="st0" d="M16.75 9H13.5V7a1 1 0 011-1h2V3H14a4 4 0 00-4 4V9H8v3h2v9h3.5V12H16z"/></svg></a><li><a href="javascript:window.open('https://twitter.com/intent/tweet?text=RISC%20Is%20Fundamentally%20Unscalable&url=https%3a%2f%2ferikmcclure.com%2fblog%2frisc-is-fundamentally-unscalable%2f','popup','width=600,height=256');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><path class="st0" opacity="0" d="M0 0h24v24H0z"/><path class="st0" d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572.0-4.658 2.086-4.658 4.66.0.364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342.0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3.0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376.0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57.0 13.255-7.098 13.255-13.254.0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/></svg></a></li><li><a href="javascript:window.open('https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2ferikmcclure.com%2fblog%2frisc-is-fundamentally-unscalable%2f','popup','width=700,height=380');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><rect class="st0" height="11" width="4" x="3" y="9"/><circle class="st0" cx="5" cy="5" r="2"/><path class="st0" d="M16.5 8.25A4.47251 4.47251.0 0013 9.95343V9H9V20h4V13a2 2 0 014 0v7h4V12.75a4.5 4.5.0 00-4.5-4.5z"/></svg></a></li></ul></aside></article><article><h4><a href=/blog/migrating-to-static-blog/>Migrating To A Static Blog</a></h4><hr><div class=padding><p>I&rsquo;ve finished constructing a new personal website for myself using <a href=https://gohugo.io/>hugo</a>, and I&rsquo;m moving my blog over there so I have more control over what gets loaded, and more importantly, so the page doesn&rsquo;t attempt to load Blogger&rsquo;s 5 MB worth of bloated javascript nonsense just to read some text. It also fixes math and code highlighting while reading on mobile. If you reached this post using Blogger, you&rsquo;ll be redirected or will soon be redirected to the corresponding post on my new website.</p><p>All comments have been preserved from the original posts, but making new comments is currently disabled - I haven&rsquo;t decided if I want to use Disqus or attempt something else. An <a href=https://erikmcclure.com/index.xml><strong>RSS feed</strong></a> is available on the bottom of the page for tracking new posts that should mimic the Blogger RSS feed, if you were using that. If something doesn&rsquo;t work, <a href=https://twitter.com/erikmcclure0173><strong>poke me on twitter</strong></a> and I&rsquo;ll try to fix it.</p><p>I implemented share buttons with simple links, without embedding any crazy javascript bullshit. In fact, the only external resource loaded is a Google tracking ID for pageviews. Cloudflare is used to enforce an HTTPS connection over the custom domain even though the website is hosted on <a href=https://github.com/erikmcclure/erikmcclure.github.io>Github Pages</a>.</p><p>Hopefully, the new font and layout is easier to read than Blogger&rsquo;s tiny text and bullshit theme nonsense.</p></div><hr><time itemprop=datePublished pubdate=pubdate datetime=2018-02-06T09:07:29+00:00><i class="fa-regular fa-clock fa-fw"></i>&nbsp;Published on <a href=https://erikmcclure.com/blog/migrating-to-static-blog/>February 6, 2018 at 9:07am</a></time><aside><i class="fa-regular fa-comments fa-fw"></i>&nbsp;<a href=/blog/migrating-to-static-blog/#commento> comments</a></aside><aside><i class="fa-regular fa-share-square fa-fw"></i>&nbsp;share:<ul><li><a href="javascript:window.open('https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ferikmcclure.com%2fblog%2fmigrating-to-static-blog%2f','popup','width=600,height=400');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><path class="st0" d="M16.75 9H13.5V7a1 1 0 011-1h2V3H14a4 4 0 00-4 4V9H8v3h2v9h3.5V12H16z"/></svg></a><li><a href="javascript:window.open('https://twitter.com/intent/tweet?text=Migrating%20To%20A%20Static%20Blog&url=https%3a%2f%2ferikmcclure.com%2fblog%2fmigrating-to-static-blog%2f','popup','width=600,height=256');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><path class="st0" opacity="0" d="M0 0h24v24H0z"/><path class="st0" d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572.0-4.658 2.086-4.658 4.66.0.364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342.0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3.0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376.0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57.0 13.255-7.098 13.255-13.254.0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/></svg></a></li><li><a href="javascript:window.open('https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2ferikmcclure.com%2fblog%2fmigrating-to-static-blog%2f','popup','width=700,height=380');"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="twtr-icon twtr-color-fill--blue-dark has-hover"><style>.st0{fill:#666}</style><rect class="st0" height="11" width="4" x="3" y="9"/><circle class="st0" cx="5" cy="5" r="2"/><path class="st0" d="M16.5 8.25A4.47251 4.47251.0 0013 9.95343V9H9V20h4V13a2 2 0 014 0v7h4V12.75a4.5 4.5.0 00-4.5-4.5z"/></svg></a></li></ul></aside></article><div class=pager><ul><li><a href=/blog/page/3>Newer</a></li><li style=text-align:center><a href=/blog/>Home</a></li><li style=text-align:right><a href=/blog/page/5>Older</a></li></ul></div></section><section class=archive><article><img src=https://erikmcclure.com/img/avatar.th.png alt=Avatar width=180 height=180><h2>Archive</h2><ol><li><details><summary>2025</summary><ul><li><a href=/blog/purity-spiral/>Leftists Are In A Purity Death Spiral</a></li><li><a href=/blog/discord-overlay-breaks-gsync/>The New Discord Overlay Breaks GSync and Borderless Optimizations</a></li><li><a href=/blog/do-you-really-think-we-have-gender-in-the-future/>Do You Really Think We'll Have Genders In The Future?</a></li></ul></details></li><li><details><summary>2024</summary><ul><li><a href=/blog/stop-making-me-memorize-borrow-checker/>Stop Making Me Memorize The Borrow Checker</a></li><li><a href=/blog/rust-async-makes-me-want-to-gouge-my-eyes-out/>Rust Async Makes Me Want To Gouge My Eyes Out</a></li><li><a href=/blog/engineers-only-get-paid-something-broken/>Engineers Only Get Paid If Something Is Broken</a></li><li><a href=/blog/measuring-competence-is-epistemic-hell/>Measuring Competence Is Epistemic Hell</a></li><li><a href=/blog/we-could-fix-everything-we-just-dont/>We Could Fix Everything, We Just Don't</a></li></ul></details></li><li><details><summary>2023</summary><ul><li><a href=/blog/people-cant-care-about-everything/>People Can't Care About Everything</a></li><li><a href=/blog/discord-should-remove-usernames/>Discord Should Remove Usernames Entirely</a></li></ul></details></li><li><details><summary>2022</summary><ul><li><a href=/blog/money-is-fake/>Money Is Fake. It's Not Real. It's Made Up.</a></li><li><a href=/blog/we-need-new-motherboards/>We Need New Motherboards Before GPUs Collapse Under Their Own Gravity</a></li></ul></details></li><li><details><summary>2021</summary><ul><li><a href=/blog/cpp-constructors-memory-and-lifetimes/>C++ Constructors, Memory, and Lifetimes</a></li><li><a href=/blog/factorio-is-best-interview-we-have/>Factorio Is The Best Technical Interview We Have</a></li></ul></details></li><li><details><summary>2020</summary><ul><li><a href=/blog/why-you-cant-use-prebuilt-llvm-with-cpp17/>Why You Can't Use Prebuilt LLVM 10.0 with C++17</a></li><li><a href=/blog/pressure-based-anti-spam-for-discord-bots/>Pressure Based Anti-Spam for Discord Bots</a></li></ul></details></li><li><details><summary>2019</summary><ul><li><a href=/blog/name-shadowing-should-be-an-operator/>Name Shadowing Should Be An Operator</a></li><li><a href=/blog/a-rant-on-terra/>A Rant On Terra</a></li><li><a href=/blog/risc-is-fundamentally-unscalable/>RISC Is Fundamentally Unscalable</a></li></ul></details></li><li><details><summary>2018</summary><ul><li><a href=/blog/migrating-to-static-blog/>Migrating To A Static Blog</a></li><li><a href=/blog/how-to-avoid-memorizing-times-tables/>How To Avoid Memorizing Times Tables</a></li></ul></details></li><li><details><summary>2017</summary><ul><li><a href=/blog/ignoring-outliers-creates-racist/>Ignoring Outliers Creates Racist Algorithms</a></li><li><a href=/blog/i-used-to-want-to-work-for-google/>I Used To Want To Work For Google</a></li><li><a href=/blog/integrating-luajit-and-autogenerating-c/>Integrating LuaJIT and Autogenerating C Bindings In Visual Studio</a></li><li><a href=/blog/discord-rise-of-bot-wars/>Discord: Rise Of The Bot Wars</a></li><li><a href=/blog/companies-cant-be-apolitical/>Companies Can't Be Apolitical</a></li><li><a href=/blog/windows-wont-let-my-program-crash/>Windows Won't Let My Program Crash</a></li><li><a href=/blog/directx-is-terrifying/>DirectX Is Terrifying</a></li></ul></details></li><li><details><summary>2016</summary><ul><li><a href=/blog/everyone-does-srgb-wrong-because/>Everyone Does sRGB Wrong Because Everyone Else Does sRGB Wrong</a></li><li><a href=/blog/mathematical-notation-is-awful/>Mathematical Notation Is Awful</a></li></ul></details></li><li><details><summary>2015</summary><ul><li><a href=/blog/i-tried-to-install-linux-and-now-i/>I Tried To Install Linux And Now I Regret Everything</a></li><li><a href=/blog/you-arent-designing-software-for-robots/>We Aren't Designing Software For Robots</a></li><li><a href=/blog/using-data-to-balance-your-game-pony/>Using Data To Balance Your Game: Pony Clicker Analysis</a></li><li><a href=/blog/does-anyone-actually-want-good-software/>Does Anyone Actually Want Good Software?</a></li></ul></details></li><li><details><summary>2014</summary><ul><li><a href=/blog/how-not-to-sell-software/>How Not To Install Software</a></li><li><a href=/blog/can-we-choose-what-we-enjoy/>Can We Choose What We Enjoy?</a></li><li><a href=/blog/how-to-make-your-profiler-10x-faster/>How To Make Your Profiler 10x Faster</a></li><li><a href=/blog/the-problem-with-photorealism/>The Problem With Photorealism</a></li></ul></details></li><li><details><summary>2013</summary><ul><li><a href=/blog/googles-decline-really-bugs-me/>Google's Decline Really Bugs Me</a></li><li><a href=/blog/the-educational-imbroglio/>The Educational Imbroglio</a></li><li><a href=/blog/write-less-code/>Write Less Code</a></li><li><a href=/blog/most-people-have-shitty-computers/>Most People Have Shitty Computers</a></li><li><a href=/blog/leap-motion-impressions-input/>Leap Motion Impressions, Input Sanitation, and 3D Gesture Ideas</a></li><li><a href=/blog/aurora-theory-released/>Aurora Theory Released!</a></li><li><a href=/blog/what-i-learned-in-college/>What I Learned In College</a></li><li><a href=/blog/course-notes/>Course Notes</a></li><li><a href=/blog/contact/>Contact</a></li><li><a href=/blog/the-dark-side-of-htmlcss/>The Dark Side of Web Development</a></li><li><a href=/blog/windows-breaks-assert-inside/>Windows Breaks assert() Inside WM_CANCELMODE</a></li><li><a href=/blog/the-productivity-fallacy/>The Productivity Fallacy</a></li></ul></details></li><li><details><summary>2012</summary><ul><li><a href=/blog/c-to-c-tutorial-part-4-operator-overload/>C# to C++ Tutorial - Part 4: Operator Overload</a></li><li><a href=/blog/7-problems-raytracing-doesnt-solve/>7 Problems Raytracing Doesn't Solve</a></li><li><a href=/blog/analyzing-xkcd-click-and-drag/>Analyzing XKCD: Click and Drag</a></li><li><a href=/blog/coordinate-systems-and-cascading/>Coordinate Systems And Cascading Stupidity</a></li><li><a href=/blog/how-joysticks-ruined-my-graphics-engine/>How Joysticks Ruined My Graphics Engine</a></li><li><a href=/blog/multithreading-problems-in-game-design/>Multithreading Problems In Game Design</a></li><li><a href=/blog/stop-following-rules/>Stop Following The Rules</a></li><li><a href=/blog/why-windows-8-does-right-thing-wrong/>Why Windows 8 Does The Right Thing The Wrong Way</a></li><li><a href=/blog/visual-studio-broke-my-computer/>Visual Studio Broke My Computer</a></li><li><a href=/blog/implicit-ui-design/>Implicit UI Design</a></li><li><a href=/blog/linux-mint-12-kde/>Linux Mint 12 KDE</a></li><li><a href=/blog/new-post/>'Programmer' is an Overgeneralization</a></li></ul></details></li><li><details><summary>2011</summary><ul><li><a href=/blog/great-mystery-of-linear-gradient/>The Great Mystery of Linear Gradient Lighting</a></li><li><a href=/blog/signed-integers-considered-stupid-like/>Signed Integers Considered Stupid (Like This Title)</a></li><li><a href=/blog/c-to-c-tutorial-part-3-classes-and/>C# to C++ Tutorial - Part 3: Classes and Structs and Inheritance (OH MY!)</a></li><li><a href=/blog/problem-of-vsync/>The Problem of Vsync</a></li><li><a href=/blog/c-to-c-tutorial-part-2-pointers/>C# to C++ Tutorial - Part 2: Pointers Everywhere!</a></li><li><a href=/blog/c-to-c-tutorial-part-1-basics-of-syntax/>C# to C++ Tutorial - Part 1: Basics of Syntax</a></li><li><a href=/blog/ninth-circle-of-bugs/>The Ninth Circle of Bugs</a></li><li><a href=/blog/investigating-low-level-cpu-performance/>Investigating Low-level CPU Performance</a></li></ul></details></li><li><details><summary>2010</summary><ul><li><a href=/blog/im-failure/>The IM Failure</a></li><li><a href=/blog/album-for-sale-renascent/>Album For Sale! [Renascent]</a></li><li><a href=/blog/wavsaver/>WavSaver</a></li><li><a href=/blog/pixel-perfect-hit-testing/>Pixel Perfect Hit Testing</a></li><li><a href=/blog/8-bit-color-cycling/>8-bit color cycling</a></li><li><a href=/blog/physics-networking/>Physics Networking</a></li><li><a href=/blog/assembly-cas-implementation/>Assembly CAS implementation</a></li><li><a href=/blog/function-pointer-speed/>Function Pointer Speed</a></li><li><a href=/blog/most-bizarre-error-ever/>Most Bizarre Error Ever</a></li></ul></details></li><li><details><summary>2009</summary><ul><li><a href=/blog/physics-oriented-network-interpolation/>Physics-oriented Network Interpolation</a></li></ul></details></li></ol></article></section></main><footer><p><span>Copyright &copy;2025 Erik McClure</span> <a href=https://erikmcclure.com/sitemap.xml>Sitemap</a> | <a href=https://erikmcclure.com/blog/index.xml>RSS Feed</a></p></footer></div><script>"use strict";window.onload=function(){e=document.getElementsByClassName("math");for(var e,t=0,n=e.length;t<n;t++)renderMathInElement(e[t],{delimiters:[{left:"$$",right:"$$",display:!1},{left:"\\[",right:"\\]",display:!0}]})}</script></body></html>